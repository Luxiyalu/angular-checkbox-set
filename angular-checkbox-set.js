// Generated by CoffeeScript 1.8.0
(function() {
  var module;

  module = angular.module('luxiyalu.checkboxSet', []);

  module.value('checkboxHooks', {});

  module.directive('checkbox', function(checkboxHooks) {
    return {
      restrict: 'E',
      scope: {
        hook: '=',
        hookedTo: '=',
        statusStoredIn: '='
      },
      template: '<div class="checkbox-outer" ng-click="toggleCheck()">' + '<div class="checkbox-inner" ng-show="statusStoredIn.checked"></div>' + '</div>',
      link: function($scope, element, attr) {
        var broadcastUpdate, ccb, emitUpdate, hook, hookedTo, pcb, statusObj;
        hook = $scope.hook;
        hookedTo = $scope.hookedTo;
        statusObj = $scope.statusStoredIn;
        if (hookedTo != null) {
          pcb = checkboxHooks[hookedTo] != null ? checkboxHooks[hookedTo] : checkboxHooks[hookedTo] = {};
          if (pcb.children == null) {
            pcb.children = [];
          }
          pcb.children.push({
            scope: $scope,
            parent: hookedTo,
            statusObj: statusObj
          });
        }
        if (hook != null) {
          ccb = checkboxHooks[hook] != null ? checkboxHooks[hook] : checkboxHooks[hook] = {};
          if (ccb.scope == null) {
            ccb.scope = $scope;
          }
          ccb.parent = hookedTo;
          $scope.checkIfAll = function(state) {
            var result;
            return result = ccb.children.every(function(e, i, a) {
              return e.statusObj.checked === state;
            });
          };
        }
        $scope.toggleCheck = function(specify, direction) {
          statusObj.checked = specify != null ? specify : !statusObj.checked;
          if (specify == null) {
            broadcastUpdate();
            return emitUpdate();
          } else if (direction === 'broadcast') {
            return broadcastUpdate();
          } else if (direction === 'emit') {
            return emitUpdate();
          }
        };
        broadcastUpdate = function() {
          var child, _i, _len, _ref, _results;
          if ((ccb != null ? ccb.children : void 0) == null) {
            return;
          }
          _ref = ccb.children;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            child = _ref[_i];
            _results.push(child.scope.toggleCheck(statusObj.checked, 'broadcast'));
          }
          return _results;
        };
        return emitUpdate = function() {
          if (hookedTo == null) {
            return;
          }
          if (!statusObj.checked) {
            return pcb.scope.toggleCheck(false, 'emit');
          } else {
            if (!pcb.scope.checkIfAll(true)) {
              return;
            }
            return pcb.scope.toggleCheck(true, 'emit');
          }
        };
      }
    };
  });

}).call(this);
